# 액션에서 계산 빼내기 - 핵심 정리

## 핵심 개념

- **액션**: 외부 세계와 상호작용하는 함수. 실행 시점과 횟수에 따라 결과가 달라질 수 있음
  - 예: DB 쿼리, 파일 읽기/쓰기, API 호출, 콘솔 출력
- **계산**: 입력 값만으로 출력이 결정되는 순수 함수. 동일한 입력에 항상 동일한 결과
  - 예: 세금 계산, 할인율 적용, 문자열 포맷팅

## 특징 비교

| 액션                           | 계산                            |
| ------------------------------ | ------------------------------- |
| 호출 시점에 따라 결과가 달라짐 | 입력으로만 출력이 결정됨        |
| 호출 횟수에 따라 결과가 달라짐 | 같은 입력은 항상 같은 출력 보장 |
| 외부 세계와 상호작용함         | 외부 세계와 상호작용하지 않음   |
| 테스트하기 어려움              | 테스트하기 쉬움                 |

## 액션과 계산 구분의 중요성

- 액션은 실행 시점과 횟수가 중요하므로 세심한 주의 필요
- 계산은 시점/횟수 무관하므로 자유롭게 최적화 가능
- 이 구분을 통해 코드의 안전한 리팩토링 영역 확보
- 테스트 용이성: 계산은 단위 테스트 쉬움, 액션은 모의 객체(mock) 필요

## 액션에서 계산 분리하기 (4단계)

1. **암묵적 입력과 출력 식별**

   - 매개변수 외 사용하는 것 = '암묵적 입력' (전역 변수, DB 읽기 등)
   - 반환값 외 영향 미치는 것 = '암묵적 출력' (전역 변수 수정, DB 쓰기 등)

2. **재사용 가능한 계산으로 추출**

   - 암묵적 입력 → 명시적 매개변수로 변환
   - 암묵적 출력 → 명시적 반환값으로 변환

3. **계산 테스트하기**

   - 분리된 계산 함수는 입력만으로 검증 가능
   - 다양한 경계 조건과 사례로 테스트

4. **액션 단순화**
   - 액션은 최소한의 기능만 담당
   - 복잡한 로직은 계산 함수에 위임

## 액션 vs 계산 구분을 위한 체크리스트

- [] 함수가 외부 자원(DB, 파일 등)에 접근하는가? → 액션
- [] 전역 변수를 읽거나 수정하는가? → 액션
- [] 함수의 결과가 호출 시점에 따라 달라지는가? → 액션
- [] 같은 입력에 항상 같은 출력을 보장하는가? → 계산
- [] 함수 내부에서 다른 액션을 호출하는가? → 액션

## 간단한 코드 예시

변환 전 (액션과 계산이 섞임):

```javascript
function applyDiscount(cart) {
  // 외부 DB에서 할인율 읽기 (액션)
  const discountRate = getDiscountRateFromDB();

  // 현재 날짜 확인 (액션)
  const today = new Date();

  // 할인 계산 및 적용 (계산)
  let finalTotal = 0;
  for (let item of cart.items) {
    let price = item.price;
    if (today.getDay() === 0) {
      // 일요일 추가 할인
      price = price * 0.9;
    }
    price = price * (1 - discountRate);
    finalTotal += price;
  }

  // DB에 결과 저장 (액션)
  saveCartToDB(cart.id, finalTotal);

  return finalTotal;
}
```
