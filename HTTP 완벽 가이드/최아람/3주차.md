# 5. 웹서버
- 모든 웹서버는 리소스에 대한 HTTP 요청을 받아서 컨텐츠를 클라이언트에게 돌려준다.
- 웹서버는 HTTP 프로토콜을 구현하고, 웹 리소스를 관리하고, 웹 서버 관리 기능을 제공한다.
- 웹서버는 TCP 커넥션 관리에 대한 책임을 운영체제와 나눠 갖는다.

- 진짜 웹서버가 하는 일
  - 커넥션을 맺는다 
    - 클라이언트 커넥션 수락
      - 클라이언트가 웹 서버에 TCP 커넥션을 요청하면, 웹서버는 그 커넥션을 맺고 TCP 커넥션에서 IP 주소를 추출하여 커넥션 맞은편에 어떤 클라이언트가 있는지 확인한다.
      - 대부분의 웹서버는 역방향 DNS(reverse DNS)를 사용해서 클라이언트의 IP 주소를 클라이언트의 호스트 명으로 변환하도록 설정되어 있다.
  - 요청을 받는다
    - 커넥션 입력/출력 처리 아키텍처
      - 단일 스레드 웹 서버
      - 멀티프로세스와 멀티스레드 웹 서버
      - 다중 I/O 서버
  - 요청을 처리한다
  - 리소스에 접근한다.
    - 리소스의 매핑과 접근
      - 요청에 맞게 생성하는 프로그램에 URI를 매핑한다.
      - 어떤 리소스가 서버사이드 인클루드를 포함하고 있는 것으로 설정되어 있다면, 서버는 그 리소스의 컨텐츠를 클라이언트에게 보내기 전에 처리한다.
  - 응답을 만든다
  - 응답을 보낸다
  - 트랜잭션을 로그로 남긴다.

# 6. 프락시
- 웹 프락시는 서버는 중개자다.
- 트랜잭션을 완료하는 것이 클라이언트라는 점은 변하지 않지만, 프락시 서버가 제공하는 좋은 서비스를 이요하게 된다.
- HTTP 프락시는 좋은 웹 서버이기도 하고 웹 클라이언트이기도 하다. 프락시는 HTTP 클라이언트의 요청을 받게 되므로, 반드시 웹 서버처럼 요청과 커넥션을 적절히 다루고 응답을 돌려줘야 한다. 동시에 프락시는 요청을 서버로 보내기도 하므로, 요청을 보내고 응답을 받는 올바른 HTTP 클라이언트처럼 동작해야 한다.
- 공용 프락시
  - 대부분의 프락시는 공요이며 공유된 프락시다.
- 개인 프락시
  - 그다지 흔하지는 않지만 꾸준히 사용되고 있다.
- 프락시 vs 게이트웨이
  - 프락시는 같은 프로토콜을 사용하는 둘 이상의 애플리케이션을 연결
  - 게이트웨이는 서로 다른 프로토콜을 사용하는 둘 이상을 연결한다.
    - 클라이언트와 서버가 서로 다른 프로토콜을 말하더라도 서로 간의 트랜잭션을 완료할 수 있도록 해주는 포로토콜 변환기처럼 동작한다.
  - 프락시는 보안을 개선하고, 성능을 높여주며 비용을 절약한다. 모든 HTTP 트래픽을 들여다보고 건드릴 수 있기 때문에, 프락시는 부가적인 가치를 주는 여러 유용한 웹 서비스를 구현하기 위해 트래픽을 감시하고 수정할 수 있다.
    - 어린이 필터
    - 문서 접근 제어자
    - 보안 방화벽
    - 웹 캐시
    - 대리 프락시
    - 컨텐츠 라우터
    - 트랜스코더
    - 익명화 프락시
- 프락시 서버 배치
  - 어떻게 사용할지에 따라서 프락시는 어디에든 배치할 수 있다.
    - 출구 프락시
    - 접근(입구) 프락시
    - 대리 프락시
      - 네트워크의 가장 끝에 있는 웹 서버들의 바로 앞에 위치하여 웹 서버로 향하는 모든 요청을 처리하고 필욯나 때만 웹서버에게 자원을 요청할 수 있다.
    - 네트워크 교환 프락시
- 프락시 계층
  - 프락시서버들은 부무와 자식의 관계를 갖는다.
  - 프락시 계층 컨텐츠 라우팅 : 프락시 계층은 정적이다.
- 클라이언트 트래픽이 프락시로 가도록 만드는 방법은 4가지
  - 클라이언트를 수정한다.
  - 네트워크를 수정한다
    - 일반적으로 HTTP 트래픽을 지켜보고 가로채어 클라이언트 모르게 트래픽을 프락시로 보내는 스위칭 장치와 라우팅 장치를 필요로 한다. 이걸 인터셉트 프락시라고 한다.
  - DNS 이름 공간을 수정한다.
- 클라이언트 프락시 설정
  - 브라우저가 프락시를 설정
    - 수동 설정
    - 브라우저 기본 설정
    - 프락시 자동 설정
    - WAPD 프락시 발견
- 프락시 요청의 미묘한 특징들
  - 프락시 URI는 서버 URI와 다르다
    - 클라이언트가 웹 서버로 요청을 보낼 때, 요청줄은 다음의 예와 같이 스킴, 호스트, 포트 번호가 없는 부분 URI를 가진다.
    - 클라이언트가 프락시로 요청을 보낼 때 요청줄은 완전한 URI를 갖는다.
  - 가상 호스팅에서 일어나는 같은 문제
    - 명시적인 프락시는 요청 메시지가 완전한 URI를 갖도록 함으로써 이 문제를 해결했다.
    - 가상으로 호스팅 되는 웹 서버는 호스트와 포트에 대한 정보가 담겨있는 Host 헤더를 요구한다.
  - 인터셉트 프락시는 부분 URI를 받는다.
  - 프락시는 프락시 요청과 서버 요청을 모두 다룰 수 있다.
    - 완전 URI와 부분 URI를 사용하는 규칙
      - 완전한 URI가 주어졌다면 프락시는 그것을 사용해야 한다.
      - 부분 URI가 주어졌고 Host 헤더가 있다면, Host 헤더를 이용해 원 서버의 이름과 포트 번호를 알아내야 한다.
      - 부분 URI가 주어졌으나 Host 헤더가 없다면, 다음의 방ㅂ버으로 원 서버를 알아내야 한다.
        - 프락시가 원 서벌르 대신하는 대리 프락시라면, 프락시에 실제 서버의 주소와 포트 번호가 설정되어 있을 수 있다.
        - 이전에 어떤 인터셉트 프락시가 가로챘던 트래픽을 받았고, 그 인터셉트 프락시가 원 IP주소와 포트번호를 사용할 수 있도록 해두었다면 그 IP주소와 포트번호를 사용할 수 있다.
  - 전송 중 URI 변경
  - URI 클라이언트 자동확장과 호스트명 분석
  - 프락시 없는 URI 분석
  - 명시적인 프락시를 사용할 때의 URI 분석
  - 인터셉트 프락시를 이용한 URI 분석
- 메시지 추적